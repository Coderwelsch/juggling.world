# pull node image
FROM node:20

ENV PORT 80
ENV NEXT_PUBLIC_MAPBOX_ACCESS_TOKEN ${NEXT_PUBLIC_MAPBOX_ACCESS_TOKEN}
ENV NEXTAUTH_URL ${NEXTAUTH_URL}
ENV NEXTAUTH_URL_INTERNAL ${NEXTAUTH_URL_INTERNAL}
ENV NEXTAUTH_SECRET ${NEXTAUTH_SECRET}
ENV NEXT_PUBLIC_MAPBOX_STYLE_URL ${NEXT_PUBLIC_MAPBOX_STYLE_URL}
ENV NEXT_PUBLIC_CMS_GRAPHQL_API_URL ${NEXT_PUBLIC_CMS_GRAPHQL_API_URL}
ENV INTERNAL_CMS_GRAPHQL_API_URL ${INTERNAL_CMS_GRAPHQL_API_URL}
ENV CMS_API_ACCESS_TOKEN ${CMS_API_ACCESS_TOKEN}

# set working directory
WORKDIR /usr/src/app

# copy package.json and package-lock.json
COPY package.json ./
COPY yarn.lock ./

# install dependencies
RUN yarn install

# copy source code
COPY . .

# expose port
EXPOSE 80

# run app
CMD ["yarn", "dev"]
