FROM node:18.16

WORKDIR /srv/app

COPY package.json yarn.lock ./

RUN yarn install

COPY . .

EXPOSE 80

ENV NODE_ENV development

ENV APP_PROXY ${APP_PROXY}
ENV PORT ${PORT}
ENV HOST ${HOST}
ENV URL ${URL}
ENV APP_KEYS ${APP_KEYS}
ENV API_TOKEN_SALT ${API_TOKEN_SALT}
ENV ADMIN_JWT_SECRET ${ADMIN_JWT_SECRET}
ENV TRANSFER_TOKEN_SALT ${TRANSFER_TOKEN_SALT}
ENV JWT_SECRET ${JWT_SECRET}
ENV WEBHOOKS_POPULATE_RELATIONS ${WEBHOOKS_POPULATE_RELATIONS}

ENV DATABASE_CLIENT ${DATABASE_CLIENT}
ENV DATABASE_HOST ${DATABASE_HOST}
ENV DATABASE_PORT ${DATABASE_PORT}
ENV DATABASE_NAME ${DATABASE_NAME}
ENV DATABASE_USERNAME ${DATABASE_USERNAME}
ENV DATABASE_PASSWORD ${DATABASE_PASSWORD}

RUN yarn build

# Start the Strapi development server
CMD ["yarn", "run", "develop"]
